<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0 from src/site/markdown/examples/invoker-tests.md.vm at 2025-08-21
 | Rendered using Apache Maven Fluido Skin 2.1.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0" />
    <meta name="author" content="Stephen Connolly" />
    <meta name="date" content="2013-02-23" />
    <title>Using with Maven Invoker â€“ Mock Repository Manager Maven Plugin</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-2.1.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-2.1.0.min.js"></script>
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        _paq.push(['disableCookies']);
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);

        (function() {
            var u="https://analytics.apache.org/";
            _paq.push(['setTrackerUrl', u+'/matomo.php']);
            _paq.push(['setSiteId', '18']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Matomo Code -->
    <style>.github-fork-ribbon:before { background-color: gray; }</style>
  </head>
  <body>
    <a class="github-fork-ribbon right-top" href="https://github.com/mojohaus/mrm-maven-plugin" data-ribbon="Fork me on GitHub">Fork me on GitHub</a>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1><a href="../../../"><img src="../../../images/mojo_logo.png" alt="MojoHaus" /></a></h1></div></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
      <li><a href="../../../">MojoHaus</a><span class="divider">/</span></li>
      <li><a href="../..">Mock Repository Manager :: Project</a><span class="divider">/</span></li>
      <li><a href="../index.html">Mock Repository Manager Maven Plugin</a><span class="divider">/</span></li>
    <li class="active">Using with Maven Invoker <a href="https://github.com/mojohaus/mrm/tree/master/mrm-maven-plugin/src/site/markdown/examples/invoker-tests.md.vm"><img src="../images/accessories-text-editor.png" alt="Edit" /></a></li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2025-08-21</li>
          <li id="projectVersion" class="pull-right"><span class="divider">|</span>Version: 1.7.0</li>
        <li class="pull-right"><a href="https://maven.apache.org/">Maven</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Parent Project</li>
    <li><a href="../../index.html">Mock Repository Manager :: Project</a></li>
   <li class="nav-header">Overview</li>
    <li><a href="../index.html">Introduction</a></li>
    <li><a href="../plugin-info.html">Goals</a></li>
    <li><a href="../usage.html">Usage</a></li>
   <li class="nav-header">Examples</li>
    <li class="active"><a>Using with Maven Invoker (download)</a></li>
    <li><a href="../examples/invoker-tests-dist.html">Using with Maven Invoker (upload)</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">
<!---
Copyright 2011 Stephen Connolly

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<section><a id="Using_with_Maven_Invoker_and_Repositories"></a>
<h1>Using with Maven Invoker and Repositories</h1>
<p>The aim here is to combine the usage of the <code>mrm-maven-plugin</code> with the <code>maven-invoker-plugin</code> to
allow the integration tests of a Maven Plugin to be run against a test local repository thereby ensuring that
the plugin does not get installed into the local repository until after the integration tests have been confirmed
as passing.</p>
<p>First we need to modify the <code>pom.xml</code> to reference both <code>mrm-maven-plugin</code> and the
<code>maven-invoker-plugin</code></p>

<pre class="prettyprint"><code class="language-xml">&lt;project&gt;
  ...
  &lt;build&gt;
    ...
    &lt;plugins&gt;
      ...
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-invoker-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.9.1&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;install&lt;/goal&gt;
              &lt;goal&gt;integration-test&lt;/goal&gt;
              &lt;goal&gt;verify&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
        &lt;configuration&gt;
          &lt;localRepositoryPath&gt;${project.build.directory}/local-repo&lt;/localRepositoryPath&gt;
          &lt;projectsDirectory&gt;src/it/projects&lt;/projectsDirectory&gt;
          &lt;settingsFile&gt;src/it/mrm/settings.xml&lt;/settingsFile&gt;
          &lt;filterProperties&gt;
            &lt;mrm.repository.url&gt;${mrm.repository.url}&lt;/mrm.repository.url&gt;
          &lt;/filterProperties&gt;
          ...
        &lt;/configuration&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;mrm-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.7.0&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;start&lt;/goal&gt;
              &lt;goal&gt;stop&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
        &lt;configuration&gt;
          &lt;repositories&gt;

            &lt;!-- serve content from mock repository --&gt;
            &lt;mockRepo&gt;
              &lt;source&gt;src/it/mrm/repository&lt;/source&gt;
              &lt;!-- cloneTo&gt;target/mock-repo&lt;/cloneTo --&gt;
              &lt;!-- cloneClean&gt;true&lt;/cloneClean --&gt;
              &lt;!-- lazyArchiver&gt;false&lt;/lazyArchiver --&gt;
            &lt;/mockRepo&gt;

            &lt;!-- serve content installed by maven-invoker-plugin --&gt;
            &lt;localRepo&gt;
              &lt;source&gt;${project.build.directory}/local-repo&lt;/source&gt;
            &lt;/localRepo&gt;

            &lt;!-- pass everything else to current Maven instance --&gt;
            &lt;proxyRepo/&gt;
          &lt;/repositories&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
    ...
  &lt;/build&gt;
  ...
&lt;/project&gt;
</code></pre>
<p>This will result in the following mojos being executed during the lifecycle as follows:</p>
<table class="table table-striped">
<thead>
<tr class="a">
<th><em>Phase</em></th>
<th><em>Goal(s)</em></th></tr></thead><tbody>
<tr class="b">
<td>pre-integration-test</td>
<td>mrm:start, invoker:install</td></tr>
<tr class="a">
<td>integration-test</td>
<td>invoker:integration-test</td></tr>
<tr class="b">
<td>post-integration-test</td>
<td>mrm:stop</td></tr>
<tr class="a">
<td>verify</td>
<td>invoker:verify</td></tr></tbody>
</table>

<p>Additionally, when <code>mrm:start</code> is invoked, it will bind to an available port and set the property
<code>repository.proxy.url</code> to the URL on which the repository is being hosted, and the repository content
will be based on the <code>mockRepo</code> content generated from the following files in <code>src/it/mrm/repository</code>:</p>
<ul>

<li>
<p><code>**/*.pom</code></p></li>
<li>
<p><code>**/*-{classifier}.{type}</code> as file, which will use the GAV of the corresponding <code>pom</code> - file (e.g. <code>mojo-parent-10.pom</code> with <code>mojo-parent-10-site.xml</code> )</p></li>
<li>
<p><code>**/*.{archiver extension}</code> as directory, which will use the GAV of the corresponding <code>pom</code> - file. MRM will create an archive of this directory.</p></li>
<li>
<p><code>**/*-{classifier}.{archiver extension}</code> as directory, which will use the GAV of the corresponding <code>pom</code> - file. MRM will create an archive of this directory.</p></li>
<li>
<p><code>archetype-catalog.xml</code></p></li>
<li>
<p><code>{archiver extension}</code> can be one of supported by <a href="https://codehaus-plexus.github.io/plexus-archiver/" class="externalLink">plexus archiver</a>, e.g. <code>jar</code>, <code>zip</code>, <code>tar.gz</code>, <code>tgz</code>, <code>tar.xz</code>, etc.</p></li>
</ul>
<p>In additional content install by <code>maven-invoker-plugin:install</code> will be available by <em>localRepo</em></p>
<p>Finally thanks to <code>proxyRepo</code>, all the repositories available to the current Maven instance will be available too.</p>
<p>We tell <code>maven-invoker-plugin</code> to use the <code>settings.xml</code> file from <code>src/it/mrm/settings.xml</code>
which will look something like:</p>

<pre class="prettyprint"><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;settings&gt;
  &lt;mirrors&gt;
    &lt;mirror&gt;
      &lt;id&gt;mrm-maven-plugin&lt;/id&gt;
      &lt;name&gt;Mock Repository Manager&lt;/name&gt;
      &lt;url&gt;@mrm.repository.url@&lt;/url&gt;
      &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
    &lt;/mirror&gt;
  &lt;/mirrors&gt;
  &lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;it-repo&lt;/id&gt;
      &lt;repositories&gt;
        &lt;repository&gt;
          &lt;id&gt;snapshots&lt;/id&gt;
          &lt;url&gt;@mrm.repository.url@&lt;/url&gt;
          &lt;releases&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;checksumPolicy&gt;ignore&lt;/checksumPolicy&gt;
            &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;
          &lt;/releases&gt;
          &lt;snapshots&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;checksumPolicy&gt;ignore&lt;/checksumPolicy&gt;
            &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
          &lt;/snapshots&gt;
        &lt;/repository&gt;
      &lt;/repositories&gt;
      &lt;pluginRepositories&gt;
        &lt;pluginRepository&gt;
          &lt;id&gt;snapshots&lt;/id&gt;
          &lt;url&gt;@mrm.repository.url@&lt;/url&gt;
          &lt;releases&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;checksumPolicy&gt;ignore&lt;/checksumPolicy&gt;
            &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;
          &lt;/releases&gt;
          &lt;snapshots&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;checksumPolicy&gt;ignore&lt;/checksumPolicy&gt;
            &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
          &lt;/snapshots&gt;
        &lt;/pluginRepository&gt;
      &lt;/pluginRepositories&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
  &lt;activeProfiles&gt;
    &lt;activeProfile&gt;it-repo&lt;/activeProfile&gt;
  &lt;/activeProfiles&gt;
  
&lt;/settings&gt;
</code></pre>
<p>And we also have instructed the <code>maven-invoker-plugin</code> to filter in the property value <code>repository.proxy.url</code>
Thus when the integration tests run, they will use the mock repository manager that we have provisioned.</p></section>        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Â©      2009â€“2025
<a href="https://www.mojohaus.org">MojoHaus</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>